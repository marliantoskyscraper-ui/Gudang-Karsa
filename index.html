import React, { useState, useEffect, useRef } from 'react';
import { 
  Camera, MapPin, User, LogOut, FileText, 
  Users, Bell, Calendar, CheckCircle, XCircle, 
  Menu, Download, Upload, Clock, Home, AlertCircle, Coffee 
} from 'lucide-react';

/**
 * MOCK DATA & CONFIGURATION
 * Data awal untuk simulasi sistem
 */
const INITIAL_USERS = [
  { id: 1, name: 'Super Admin', email: 'admin@kantor.com', role: 'admin', password: 'admin', department: 'HRD', phone: '08123456789' },
  { id: 2, name: 'Budi Santoso', email: 'budi@kantor.com', role: 'employee', password: 'user', department: 'IT', phone: '08198765432' },
  { id: 3, name: 'Siti Aminah', email: 'siti@kantor.com', role: 'employee', password: 'user', department: 'Finance', phone: '08122334455' },
];

const INITIAL_ANNOUNCEMENTS = [
  { id: 1, title: 'Libur Nasional', content: 'Hari Jumat kantor libur memperingati hari besar.', date: '2023-10-20' },
  { id: 2, title: 'Rapat Bulanan', content: 'Evaluasi kinerja dilakukan hari Senin pukul 09:00.', date: '2023-10-22' },
];

const INITIAL_LOGS = [
  { id: 101, userId: 2, name: 'Budi Santoso', type: 'Masuk', timestamp: new Date(Date.now() - 86400000).toISOString(), location: '-6.2088, 106.8456', photo: null, status: 'On Time' },
  { id: 102, userId: 3, name: 'Siti Aminah', type: 'Masuk', timestamp: new Date(Date.now() - 86000000).toISOString(), location: '-6.2088, 106.8456', photo: null, status: 'On Time' },
];

// Komponen Format Tanggal Indonesia
const formatDate = (dateString) => {
  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
  return new Date(dateString).toLocaleDateString('id-ID', options);
};

// --- KOMPONEN UI DASAR ---

const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false, icon: Icon }) => {
  const baseStyle = "px-4 py-2 rounded-lg font-medium transition duration-200 flex items-center justify-center gap-2";
  const variants = {
    primary: "bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-300",
    secondary: "bg-gray-100 text-gray-700 hover:bg-gray-200",
    danger: "bg-red-500 text-white hover:bg-red-600",
    success: "bg-green-600 text-white hover:bg-green-700",
    warning: "bg-yellow-500 text-white hover:bg-yellow-600",
    outline: "border border-gray-300 text-gray-700 hover:bg-gray-50"
  };

  return (
    <button 
      onClick={onClick} 
      disabled={disabled}
      className={`${baseStyle} ${variants[variant]} ${className}`}
    >
      {Icon && <Icon size={18} />}
      {children}
    </button>
  );
};

const Card = ({ children, className = '' }) => (
  <div className={`bg-white rounded-xl shadow-sm border border-gray-100 p-4 ${className}`}>
    {children}
  </div>
);

const Badge = ({ children, type = 'info' }) => {
  const styles = {
    info: 'bg-blue-100 text-blue-800',
    success: 'bg-green-100 text-green-800',
    warning: 'bg-yellow-100 text-yellow-800',
    danger: 'bg-red-100 text-red-800',
  };
  return (
    <span className={`px-2 py-1 rounded-full text-xs font-semibold ${styles[type] || styles.info}`}>
      {children}
    </span>
  );
};

// --- HALAMAN UTAMA ---

export default function App() {
  const [currentUser, setCurrentUser] = useState(null);
  const [users, setUsers] = useState(INITIAL_USERS);
  const [logs, setLogs] = useState(INITIAL_LOGS);
  const [announcements, setAnnouncements] = useState(INITIAL_ANNOUNCEMENTS);
  
  // State Login
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [loginError, setLoginError] = useState('');

  // Navigasi Sederhana
  const [activeTab, setActiveTab] = useState('dashboard');

  const handleLogin = (e) => {
    e.preventDefault();
    const user = users.find(u => u.email === email && u.password === password);
    if (user) {
      setCurrentUser(user);
      setLoginError('');
      setActiveTab('dashboard');
    } else {
      setLoginError('Email atau password salah!');
    }
  };

  const handleLogout = () => {
    setCurrentUser(null);
    setEmail('');
    setPassword('');
    setActiveTab('dashboard');
  };

  if (!currentUser) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-white rounded-2xl shadow-xl overflow-hidden">
          <div className="bg-blue-600 p-8 text-center">
            <div className="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm">
              <CheckCircle size={32} className="text-white" />
            </div>
            <h1 className="text-2xl font-bold text-white">E-Absensi Pro</h1>
            <p className="text-blue-100 text-sm">Sistem Absensi Terintegrasi GPS & Selfie</p>
          </div>
          
          <form onSubmit={handleLogin} className="p-8 space-y-4">
            {loginError && (
              <div className="bg-red-50 text-red-600 p-3 rounded-lg text-sm flex items-center gap-2">
                <AlertCircle size={16} /> {loginError}
              </div>
            )}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input 
                type="email" 
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                placeholder="admin@kantor.com"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <input 
                type="password" 
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="*****"
                required
              />
            </div>
            <Button className="w-full mt-4">Masuk Sistem</Button>
            
            <div className="text-center text-xs text-gray-500 mt-4">
              <p>Demo Admin: admin@kantor.com / admin</p>
              <p>Demo User: budi@kantor.com / user</p>
            </div>
          </form>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 flex flex-col">
      {/* Header */}
      <header className="bg-white shadow-sm sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">A</div>
            <h1 className="font-bold text-gray-800 hidden sm:block">E-Absensi</h1>
          </div>
          
          <div className="flex items-center gap-4">
            <div className="text-right hidden sm:block">
              <p className="text-sm font-medium text-gray-900">{currentUser.name}</p>
              <p className="text-xs text-gray-500 capitalize">{currentUser.role}</p>
            </div>
            <button onClick={handleLogout} className="p-2 hover:bg-gray-100 rounded-full text-red-500">
              <LogOut size={20} />
            </button>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="flex-1 max-w-7xl w-full mx-auto p-4">
        {currentUser.role === 'admin' ? (
          <AdminDashboard 
            users={users} 
            setUsers={setUsers} 
            logs={logs} 
            announcements={announcements}
            setAnnouncements={setAnnouncements}
          />
        ) : (
          <EmployeeDashboard 
            user={currentUser} 
            logs={logs} 
            setLogs={setLogs}
            announcements={announcements}
          />
        )}
      </main>
    </div>
  );
}

// --- DASHBOARD ADMIN ---

function AdminDashboard({ users, setUsers, logs, announcements, setAnnouncements }) {
  const [view, setView] = useState('overview'); // overview, employees, reports, announcements
  const [newUser, setNewUser] = useState({ name: '', email: '', department: '', role: 'employee' });

  // Stats
  const todayLogs = logs.filter(l => new Date(l.timestamp).toDateString() === new Date().toDateString());
  const uniqueAttendees = new Set(todayLogs.map(l => l.userId)).size;

  const handleAddUser = (e) => {
    e.preventDefault();
    const id = users.length + 1;
    setUsers([...users, { ...newUser, id, password: 'user' }]); // Default password
    setNewUser({ name: '', email: '', department: '', role: 'employee' });
    alert('Karyawan berhasil ditambahkan!');
  };

  const handleExport = () => {
    // Simulasi Export CSV
    let csvContent = "data:text/csv;charset=utf-8,ID,Nama,Tipe,Waktu,Lokasi\n";
    logs.forEach(row => {
      csvContent += `${row.id},${row.name},${row.type},${row.timestamp},"${row.location}"\n`;
    });
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "laporan_absensi.csv");
    document.body.appendChild(link);
    link.click();
  };

  const handleAddAnnouncement = (text) => {
    const newAnn = {
        id: Date.now(),
        title: "Info Admin",
        content: text,
        date: new Date().toISOString().split('T')[0]
    };
    setAnnouncements([newAnn, ...announcements]);
  };

  return (
    <div className="space-y-6">
      {/* Navigation Tabs */}
      <div className="flex overflow-x-auto gap-2 pb-2">
        {[
          { id: 'overview', label: 'Dashboard', icon: Home },
          { id: 'employees', label: 'Data Karyawan', icon: Users },
          { id: 'reports', label: 'Laporan Absensi', icon: FileText },
          { id: 'announcements', label: 'Pengumuman', icon: Bell },
        ].map((tab) => (
          <button
            key={tab.id}
            onClick={() => setView(tab.id)}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg whitespace-nowrap transition ${
              view === tab.id 
                ? 'bg-blue-600 text-white shadow-md' 
                : 'bg-white text-gray-600 hover:bg-gray-50'
            }`}
          >
            <tab.icon size={18} />
            {tab.label}
          </button>
        ))}
      </div>

      {view === 'overview' && (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <Card className="bg-gradient-to-br from-blue-500 to-blue-600 text-white border-none">
            <h3 className="text-blue-100 font-medium">Total Karyawan</h3>
            <p className="text-3xl font-bold mt-2">{users.length - 1}</p> {/* Exclude admin */}
          </Card>
          <Card className="bg-gradient-to-br from-green-500 to-green-600 text-white border-none">
            <h3 className="text-green-100 font-medium">Hadir Hari Ini</h3>
            <p className="text-3xl font-bold mt-2">{uniqueAttendees}</p>
          </Card>
          <Card className="bg-gradient-to-br from-purple-500 to-purple-600 text-white border-none">
            <h3 className="text-purple-100 font-medium">Belum Hadir</h3>
            <p className="text-3xl font-bold mt-2">{(users.length - 1) - uniqueAttendees}</p>
          </Card>

          <div className="md:col-span-3">
             <h3 className="text-lg font-bold text-gray-800 mb-4">Aktivitas Terbaru</h3>
             <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <table className="w-full text-left text-sm">
                  <thead className="bg-gray-50 border-b">
                    <tr>
                      <th className="p-4 font-medium text-gray-600">Nama</th>
                      <th className="p-4 font-medium text-gray-600">Waktu</th>
                      <th className="p-4 font-medium text-gray-600">Tipe</th>
                      <th className="p-4 font-medium text-gray-600">Lokasi</th>
                    </tr>
                  </thead>
                  <tbody>
                    {logs.slice(0, 5).map(log => (
                      <tr key={log.id} className="border-b last:border-0 hover:bg-gray-50">
                        <td className="p-4 font-medium">{log.name}</td>
                        <td className="p-4 text-gray-500">{formatDate(log.timestamp)}</td>
                        <td className="p-4">
                          <Badge type={log.type === 'Masuk' ? 'success' : log.type === 'Istirahat' ? 'warning' : 'danger'}>{log.type}</Badge>
                        </td>
                        <td className="p-4 text-gray-500 truncate max-w-xs">{log.location}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
             </div>
          </div>
        </div>
      )}

      {view === 'employees' && (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div className="lg:col-span-2">
            <div className="bg-white rounded-xl shadow-sm border overflow-hidden">
                <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                    <h3 className="font-bold text-gray-700">Daftar Karyawan</h3>
                    <Button variant="outline" icon={Upload} onClick={() => alert("Fitur Import Excel akan membuka file dialog.")}>Import Excel</Button>
                </div>
                <table className="w-full text-left text-sm">
                  <thead className="bg-gray-50 border-b">
                    <tr>
                      <th className="p-3">Nama</th>
                      <th className="p-3">Email</th>
                      <th className="p-3">Dept</th>
                      <th className="p-3">Aksi</th>
                    </tr>
                  </thead>
                  <tbody>
                    {users.filter(u => u.role !== 'admin').map(u => (
                      <tr key={u.id} className="border-b">
                        <td className="p-3 font-medium">{u.name}</td>
                        <td className="p-3 text-gray-500">{u.email}</td>
                        <td className="p-3"><Badge>{u.department}</Badge></td>
                        <td className="p-3">
                            <button className="text-blue-600 hover:text-blue-800 text-xs font-semibold">Edit</button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
            </div>
          </div>

          <div>
             <Card>
                <h3 className="font-bold text-gray-800 mb-4">Tambah Anggota</h3>
                <form onSubmit={handleAddUser} className="space-y-3">
                    <input className="w-full p-2 border rounded" placeholder="Nama Lengkap" value={newUser.name} onChange={e => setNewUser({...newUser, name: e.target.value})} required />
                    <input className="w-full p-2 border rounded" type="email" placeholder="Email" value={newUser.email} onChange={e => setNewUser({...newUser, email: e.target.value})} required />
                    <select className="w-full p-2 border rounded" value={newUser.department} onChange={e => setNewUser({...newUser, department: e.target.value})} required>
                        <option value="">Pilih Departemen</option>
                        <option value="IT">IT</option>
                        <option value="HRD">HRD</option>
                        <option value="Finance">Finance</option>
                        <option value="Marketing">Marketing</option>
                    </select>
                    <Button className="w-full" variant="success">Simpan Data</Button>
                </form>
             </Card>
          </div>
        </div>
      )}

      {view === 'reports' && (
        <div className="space-y-4">
            <div className="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm">
                <h2 className="font-bold text-gray-700">Laporan Kehadiran</h2>
                <Button icon={Download} onClick={handleExport}>Export ke Excel</Button>
            </div>
            <div className="bg-white rounded-xl shadow-sm border overflow-hidden overflow-x-auto">
                <table className="w-full text-left text-sm">
                    <thead className="bg-gray-50 border-b">
                    <tr>
                        <th className="p-4">Tanggal</th>
                        <th className="p-4">Nama</th>
                        <th className="p-4">Status</th>
                        <th className="p-4">Waktu</th>
                        <th className="p-4">Bukti Foto</th>
                    </tr>
                    </thead>
                    <tbody>
                    {logs.map(log => (
                        <tr key={log.id} className="border-b hover:bg-gray-50">
                        <td className="p-4">{new Date(log.timestamp).toLocaleDateString()}</td>
                        <td className="p-4 font-medium">{log.name}</td>
                        <td className="p-4"><Badge type={log.type === 'Masuk' ? 'success' : log.type === 'Istirahat' ? 'warning' : 'danger'}>{log.type}</Badge></td>
                        <td className="p-4">{new Date(log.timestamp).toLocaleTimeString()}</td>
                        <td className="p-4">
                            {log.photo ? (
                                <img src={log.photo} alt="Bukti" className="w-10 h-10 rounded-full object-cover border" />
                            ) : <span className="text-gray-400 text-xs">No Photo</span>}
                        </td>
                        </tr>
                    ))}
                    </tbody>
                </table>
            </div>
        </div>
      )}

      {view === 'announcements' && (
         <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <Card>
                <h3 className="font-bold mb-4">Buat Pengumuman Baru</h3>
                <form onSubmit={(e) => {
                    e.preventDefault();
                    handleAddAnnouncement(e.target.content.value);
                    e.target.reset();
                }}>
                    <textarea name="content" className="w-full p-3 border rounded-lg h-32 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Tulis pengumuman di sini..."></textarea>
                    <Button className="w-full mt-3">Kirim Pengumuman</Button>
                </form>
            </Card>
            <div className="space-y-3">
                {announcements.map(ann => (
                    <div key={ann.id} className="bg-white p-4 rounded-lg border shadow-sm">
                        <div className="flex justify-between items-start mb-2">
                            <h4 className="font-bold text-gray-800">{ann.title}</h4>
                            <span className="text-xs text-gray-500">{ann.date}</span>
                        </div>
                        <p className="text-sm text-gray-600">{ann.content}</p>
                    </div>
                ))}
            </div>
         </div>
      )}
    </div>
  );
}

// --- DASHBOARD KARYAWAN ---

function EmployeeDashboard({ user, logs, setLogs, announcements }) {
  const [activeTab, setActiveTab] = useState('absen'); // absen, history, permit
  const [isCameraOpen, setIsCameraOpen] = useState(false);
  const [location, setLocation] = useState(null);
  const [locationError, setLocationError] = useState(null);
  const [photo, setPhoto] = useState(null);
  const videoRef = useRef(null);
  const canvasRef = useRef(null);

  // Filter logs for current user
  const myLogs = logs.filter(l => l.userId === user.id).sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));

  // Initialize Camera
  const startCamera = async () => {
    try {
      setIsCameraOpen(true);
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      if (videoRef.current) {
        videoRef.current.srcObject = stream;
      }
    } catch (err) {
      alert("Gagal mengakses kamera. Pastikan izin diberikan.");
      setIsCameraOpen(false);
    }
  };

  // Capture Photo
  const takePhoto = () => {
    const video = videoRef.current;
    const canvas = canvasRef.current;
    if (video && canvas) {
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      const dataUrl = canvas.toDataURL('image/png');
      setPhoto(dataUrl);
      
      // Stop stream
      const stream = video.srcObject;
      const tracks = stream.getTracks();
      tracks.forEach(track => track.stop());
      setIsCameraOpen(false);
    }
  };

  // Get Location
  const getLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setLocation({
            lat: position.coords.latitude,
            lng: position.coords.longitude
          });
          setLocationError(null);
        },
        (error) => {
          setLocationError("Gagal mendapatkan lokasi. Pastikan GPS aktif.");
        }
      );
    } else {
      setLocationError("Browser tidak mendukung Geolocation.");
    }
  };

  useEffect(() => {
    if (activeTab === 'absen') {
      getLocation();
    }
  }, [activeTab]);

  const handleSubmitAttendance = (type) => {
    if (!location) return alert("Menunggu lokasi...");
    if (!photo && (type === 'Masuk' || type === 'Istirahat' || type === 'Pulang')) return alert("Wajib foto selfie!");

    const newLog = {
      id: Date.now(),
      userId: user.id,
      name: user.name,
      type: type,
      timestamp: new Date().toISOString(),
      location: `${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}`,
      photo: photo,
      status: 'Hadir'
    };

    setLogs([newLog, ...logs]);
    setPhoto(null);
    alert(`Absen ${type} Berhasil!`);
  };

  return (
    <div className="max-w-2xl mx-auto space-y-6">
      
      {/* Welcome Card */}
      <div className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white shadow-lg">
        <h2 className="text-2xl font-bold">Halo, {user.name} ðŸ‘‹</h2>
        <p className="opacity-90 mt-1">{user.department} Department</p>
        <div className="mt-6 flex gap-4 text-sm bg-white/10 p-3 rounded-lg backdrop-blur-sm">
           <div className="flex items-center gap-2">
              <Clock size={16} />
              <span>{new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'})}</span>
           </div>
           <div className="h-4 w-px bg-white/30"></div>
           <div className="flex items-center gap-2">
              <Calendar size={16} />
              <span>{new Date().toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'short' })}</span>
           </div>
        </div>
      </div>

      {/* Action Grid */}
      <div className="grid grid-cols-3 gap-3">
          <button onClick={() => setActiveTab('absen')} className={`p-4 rounded-xl flex flex-col items-center gap-2 transition ${activeTab === 'absen' ? 'bg-blue-100 text-blue-700 ring-2 ring-blue-500' : 'bg-white shadow-sm text-gray-600'}`}>
              <Camera />
              <span className="text-xs font-bold">Absen</span>
          </button>
          <button onClick={() => setActiveTab('history')} className={`p-4 rounded-xl flex flex-col items-center gap-2 transition ${activeTab === 'history' ? 'bg-blue-100 text-blue-700 ring-2 ring-blue-500' : 'bg-white shadow-sm text-gray-600'}`}>
              <Clock />
              <span className="text-xs font-bold">Riwayat</span>
          </button>
          <button onClick={() => setActiveTab('permit')} className={`p-4 rounded-xl flex flex-col items-center gap-2 transition ${activeTab === 'permit' ? 'bg-blue-100 text-blue-700 ring-2 ring-blue-500' : 'bg-white shadow-sm text-gray-600'}`}>
              <FileText />
              <span className="text-xs font-bold">Izin/Cuti</span>
          </button>
      </div>

      {/* Main Feature Area */}
      {activeTab === 'absen' && (
        <Card className="space-y-6">
           {/* Location Status */}
           <div className="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
               <div className="flex items-center gap-3">
                   <div className={`w-8 h-8 rounded-full flex items-center justify-center ${location ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}`}>
                       <MapPin size={16} />
                   </div>
                   <div>
                       <p className="text-xs text-gray-500 font-medium">Lokasi Anda</p>
                       <p className="text-sm font-bold text-gray-800">
                           {location ? `${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}` : 'Mencari lokasi...'}
                       </p>
                   </div>
               </div>
               {location && <Badge type="success">Akurat</Badge>}
           </div>

           {/* Camera Preview */}
           <div className="relative bg-black rounded-xl overflow-hidden aspect-[4/3] flex items-center justify-center">
              {!isCameraOpen && !photo && (
                <div className="text-center">
                    <p className="text-gray-400 mb-4 text-sm">Kamera belum aktif</p>
                    <Button onClick={startCamera} variant="outline" className="bg-white/10 text-white border-white/20 hover:bg-white/20">Buka Kamera</Button>
                </div>
              )}
              
              {isCameraOpen && (
                  <video ref={videoRef} autoPlay playsInline className="w-full h-full object-cover"></video>
              )}
              
              {photo && (
                  <img src={photo} alt="Captured" className="w-full h-full object-cover" />
              )}

              {/* Camera Controls */}
              {isCameraOpen && (
                  <div className="absolute bottom-4 left-0 right-0 flex justify-center">
                      <button onClick={takePhoto} className="w-16 h-16 bg-white rounded-full border-4 border-gray-300 flex items-center justify-center shadow-lg active:scale-95 transition">
                          <div className="w-12 h-12 bg-red-500 rounded-full"></div>
                      </button>
                  </div>
              )}
           </div>
            
           {/* Action Buttons */}
           {photo && (
               <div className="flex flex-col gap-3">
                   <Button variant="success" onClick={() => handleSubmitAttendance('Masuk')}>Absen Masuk</Button>
                   <Button variant="warning" onClick={() => handleSubmitAttendance('Istirahat')}>Absen Istirahat</Button>
                   <Button variant="danger" onClick={() => handleSubmitAttendance('Pulang')}>Absen Pulang</Button>
               </div>
           )}

           {photo && (
               <Button variant="outline" className="w-full" onClick={() => setPhoto(null)}>Foto Ulang</Button>
           )}
        </Card>
      )}

      {activeTab === 'history' && (
          <div className="space-y-4">
              <h3 className="font-bold text-gray-700">Riwayat Bulan Ini</h3>
              {myLogs.length === 0 ? (
                  <div className="text-center py-8 text-gray-500 bg-white rounded-xl border border-dashed">
                      Belum ada riwayat absensi.
                  </div>
              ) : (
                  myLogs.map(log => (
                      <div key={log.id} className="bg-white p-4 rounded-xl shadow-sm border flex items-center gap-4">
                          <div className={`w-12 h-12 rounded-full flex items-center justify-center shrink-0 ${log.type === 'Masuk' ? 'bg-green-100 text-green-600' : log.type === 'Istirahat' ? 'bg-yellow-100 text-yellow-600' : 'bg-red-100 text-red-600'}`}>
                              {log.type === 'Masuk' ? <LogOut className="rotate-180" size={20} /> : log.type === 'Istirahat' ? <Coffee size={20} /> : <LogOut size={20} />}
                          </div>
                          <div className="flex-1">
                              <h4 className="font-bold text-gray-800">{log.type}</h4>
                              <p className="text-xs text-gray-500">{formatDate(log.timestamp)}</p>
                              <p className="text-xs text-gray-400 mt-1 flex items-center gap-1"><MapPin size={10}/> {log.location}</p>
                          </div>
                          {log.photo && (
                              <img src={log.photo} className="w-12 h-12 rounded-lg object-cover border" alt="Proof" />
                          )}
                      </div>
                  ))
              )}
          </div>
      )}

      {/* Pengumuman Widget */}
      <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
          <div className="flex items-center gap-2 mb-2 text-yellow-800 font-bold">
              <Bell size={18} />
              <h4>Pengumuman Kantor</h4>
          </div>
          <ul className="space-y-3">
              {announcements.slice(0, 2).map(ann => (
                  <li key={ann.id} className="text-sm border-b border-yellow-200 pb-2 last:border-0 last:pb-0">
                      <p className="font-semibold text-gray-800">{ann.title}</p>
                      <p className="text-gray-600">{ann.content}</p>
                  </li>
              ))}
          </ul>
      </div>

      <canvas ref={canvasRef} className="hidden"></canvas>
    </div>
  );
}
